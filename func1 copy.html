<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Location-base</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="static\bootstrap-4.0.0-dist\css\bootstrap.min.css" rel="stylesheet">
</head>
<body id='body'>
<div class="container">
    <form action="" method="post">
        <div >
            <input type="text"  style="width:50%;" placeholder="longitude" name="longitude" value="{{
          request.form.longitude }}">
        </div>
        <div class="form-group">
            <input type="text"  style="width:50%;" placeholder="latitude" name="latitude"
                   value="{{
          request.form.latitude }}">
        </div>
        <input class="btn btn-success" type="submit" value="submit">
    </form>
    
    {% if error %}
    <p class="error"><strong>Error:</strong> {{ error }}
        {% endif %}
</div>

    {% if (resp)!=None %}
    <p>{{resp}} </p>
    {% endif %}
    <div id="chart" class="chart"></div>
    
</body>
<footer>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript">
        var data = {{output | safe}};
        var layout = {
            autosize: true,
            hovermode:'closest',
            mapbox: {
                bearing:0,
                center: {
                lat:45.518982,
                lon:-122.512881
            },
            pitch:0,
            zoom:5
            },
        }
        Plotly.setPlotConfig({
            mapboxAccessToken: "pk.eyJ1IjoibWFra3Vyb3IiLCJhIjoiY2t3YWdnZ2w1MHk5bjJ2czNqam1sb3JweiJ9.VpcwOGLkFujEWgLxc3pvJw"
        })
        if (data){
            document.getElementById('body').innerHTML+=
           ' <table id=\"table\" style="width:70%;align-self= center;padding-left=100px,padding-right=100px">'+
  '<tr >'+
    '<th style="width:30%">Name</th>'+
    '<th style="width:40%">Cate</th>'+
    '<th style="width:15%">Similar restaurant</th>'+
    '<th style="width:15%">Restaurant u maybe like </th>'+
    ' </tr>'+
                '</table>'

            for(var i=0;i<data.length;i++){
                document.getElementById('table').innerHTML+=
                '<tr>'+
                    '<td>'+data[i].name+'</td>'+
                    '<td>'+data[i].cate+'</td>'+
                    '<td><button onClick="clickedFunc2(\''+data[i].name+'\')">Similar restaurant</button></td>'+
                    '<td><button onClick="clickedFunc3(\''+data[i].name+'\')">Restaurant u maybe like</button></td>'+
                    '</tr>'
            }

        }
        console.log(data[0].cate)
        Plotly.newPlot('chart', data, layout)

    //Function 2
    function clickedFunc2(name){
        url='http://127.0.0.1:5000/location'
        $.ajax({
      url: url,
      type: "get",
      data: {name: name,func:2},
      success: function(response) {
        window.location.href = 'http://127.0.0.1:5000/content';
      },
     });
    }

    function clickedFunc3(name){
        url='http://127.0.0.1:5000/location'
        $.ajax({
      url: url,
      type: "get",
      data: {name: name,func:3},
      success: function(response) {
        window.location.href = 'http://127.0.0.1:5000/collaborative';
      },
     });
    }


        chart.on('plotly_click', function(data){
    var pts = '';
    name=0
    for(var i=0; i < data.points.length; i++){
        pts = 'x = '+data.points[i].lat +'\ny = '+
            data.points[i].lon + '\n\n' + 'name: ' + data.points[i].fullData.name;
            name=data.points[i].fullData.name
            
    }
    url='http://127.0.0.1:5000/location'
    $.ajax({
      url: url,
      type: "get",
      data: {name: name,func:2},
      success: function(response) {
        //window.location.href = 'http://127.0.0.1:5000/content';
      },
     });
    
    alert('Closest point clicked:\n\n'+pts);
});
    </script>
</footer>

</html>
<style>
    html{
        height: 100%;
        
    }
    #body{
        background-color: bisque;
        display:flex;
        justify-content: center;
        min-width: 100%;
        min-height: 100%;
    }
    #form-div{
        height: 50%;
        background-color: blue;
    }
    .container{
        display: flex;
        justify-content: center;
        align-content: center;
        background-color: blueviolet;
    }
    form{
        max-height: 50%;
        min-width: 100%;
    }
</style>